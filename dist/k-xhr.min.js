var kXhr=function(e){"use strict";function t(t){var i=e.assign(new XMLHttpRequest,{async:t.async!==!1,beforeSend:t.beforeSend,callbacks:[],cancel:n,catch:r,contentType:t.contentType,data:t.data||null,error:null,errorHandlers:[],finally:a,finallyHandler:null,headers:t.headers,method:(t.method||"get").toUpperCase(),resolve:s,state:"pending",then:l,timeout:t.timeout||3e3,url:t.url,value:null,withCredentials:t.withCredentials||!1}),o=i.method,c=i.url,h=i.async,u=i.contentType,d=i.headers,f=i.beforeSend,y=i.data;if(i.open(o,c,h),u&&i.setRequestHeader("Content-Type",u),e.isObject(d))for(var H in d)d.hasOwnProperty(H)&&i.setRequestHeader(H,d[H]);return i.onload=function(){i.status>=200&&i.status<400?(i.state="fulfilled",i.value=i.responseText,i.callbacks.length?i.resolve():i.finally()):i.onerror()},i.onerror=function(){i.state="rejected",i.error=i.responseText||i.status,i.catch()},e.isFunction(f)&&f(i),setTimeout(function(){return i.send(y)}),i}function n(){return this.abort(),this}function r(t){var n=this;return e.isFunction(t)&&this.errorHandlers.push(t),"rejected"===this.state&&(this.errorHandlers.length&&this.errorHandlers.forEach(function(e){return e.call(n,n.error)}),this.finally()),this}function s(){if(e.isObject(this.value)&&e.isFunction(this.value.then))e.assign(this.value,{callbacks:this.value.callbacks.concat(this.callbacks),errorHandlers:this.value.errorHandlers.concat(this.errorHandlers),finallyHandler:this.finallyHandler}),this.callbacks.length=0,this.errorHandlers.length=0,this.finallyHandler=null;else{var t=this.callbacks.shift();this.value=t(this.value),this.callbacks.length?this.resolve():this.finally()}}function l(e){return this.callbacks.push(e),this}function a(t){e.isFunction(t)?this.finallyHandler=t:e.isFunction(this.finallyHandler)&&this.finallyHandler()}return t}(kUtil);
