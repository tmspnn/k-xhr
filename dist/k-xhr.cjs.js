"use strict";function Ajax(e){var t=kUtil.assign(new XMLHttpRequest,{async:e.async!==!1,beforeSend:e.beforeSend,callbacks:[],cancel:xhrCancel,catch:xhrCatch,contentType:e.contentType,data:e.data||null,error:null,errorHandlers:[],finally:xhrFinally,finallyHandler:null,headers:e.headers,method:(e.method||"get").toUpperCase(),resolve:xhrResolve,state:"pending",then:xhrThen,timeout:e.timeout||3e3,url:e.url,value:null,withCredentials:e.withCredentials||!1}),l=t.method,n=t.url,r=t.async,a=t.contentType,s=t.headers,i=t.beforeSend,h=t.data;if(t.open(l,n,r),a&&t.setRequestHeader("Content-Type",a),kUtil.isObject(s))for(var o in s)s.hasOwnProperty(o)&&t.setRequestHeader(o,s[o]);return t.onload=function(){t.status>=200&&t.status<400?(t.state="fulfilled",t.value=t.responseText,t.callbacks.length?t.resolve():t.finally()):t.onerror()},t.onerror=function(){t.state="rejected",t.error=t.responseText||t.status,t.catch()},kUtil.isFunction(i)&&i(t),setTimeout(function(){return t.send(h)}),t}function xhrCancel(){return this.abort(),this}function xhrCatch(e){var t=this;return kUtil.isFunction(e)&&this.errorHandlers.push(e),"rejected"===this.state&&(this.errorHandlers.length&&this.errorHandlers.forEach(function(e){return e.call(t,t.error)}),this.finally()),this}function xhrResolve(){if(kUtil.isObject(this.value)&&kUtil.isFunction(this.value.then))kUtil.assign(this.value,{callbacks:this.value.callbacks.concat(this.callbacks),errorHandlers:this.value.errorHandlers.concat(this.errorHandlers),finallyHandler:this.finallyHandler}),this.callbacks.length=0,this.errorHandlers.length=0,this.finallyHandler=null;else{var e=this.callbacks.shift();this.value=e(this.value),this.callbacks.length?this.resolve():this.finally()}}function xhrThen(e){return this.callbacks.push(e),this}function xhrFinally(e){kUtil.isFunction(e)?this.finallyHandler=e:kUtil.isFunction(this.finallyHandler)&&this.finallyHandler()}var kUtil=require("k-util");module.exports=Ajax;
